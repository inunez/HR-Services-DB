<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:form id="mainBody">
        <p:growl id="msgs" showDetail="true" />
        <p:dashboard id="board" model="#{dashboardView.model}" >

            <p:ajax event="reorder" listener="#{dashboardView.handleReorder}" update="msgs" />

            <c:set var="employeeSelected" value="#{employeeController.selected}"/>

            <p:panel id="personalData" header="Personal Data">
                <div class="panelPersonalData">
                    <div>
                        <div class="photoBox"/>
                        <div class="fieldNameHigh3Cols">
                            <h:outputText value="Status:"/>
                        </div>
                        <div class="fieldValueHigh3Cols" id="#{employeeSelected.status1.description}">
                            <h:outputText value="#{employeeSelected.status1.description}"/>
                        </div>
                        <div class="fieldNameHigh3Cols">
                            <h:outputText value="ID Number:"/>
                        </div>
                        <div class="fieldValueHigh3Cols">
                            <h:outputText value="#{employeeSelected.employeePK.idNumber}"/>
                        </div>
                        <div class="fieldNameHigh3Cols">
                            <h:outputText value="Name:"/>
                        </div>
                        <div class="fieldValueHigh3Cols">
                            <h:outputText value="#{employeeSelected.firstName}"/>
                        </div>
                        <div class="fieldNameHigh3Cols">
                            <h:outputText value="Surname:"/>
                        </div>
                        <div class="fieldValueHigh3Cols">
                            <h:outputText value="#{employeeSelected.surname}" />
                        </div>
                        <div class="fieldNameHigh3Cols">
                            <h:outputText value="Account:"/>
                        </div>
                        <div class="fieldValueHigh3Cols">
                            <h:outputText value="#{employeeSelected.payrollCollection[0].accountNumber.accountNumber} - #{employeeSelected.payrollCollection[0].accountNumber.accountDescription}"/>
                        </div>
                    </div>
                    <div style="clear: both">
                        <div class="fieldName2Cols">
                            <h:outputText value="Hire Date:" />
                        </div>
                        <div class="fieldValue2Cols">
                            <h:outputText value="#{employeeSelected.hireDate}">
                                <f:convertDateTime pattern="dd MMMM yyyy"/>
                            </h:outputText>
                        </div>
                        <div class="fieldName2Cols">
                            <h:outputText value="Reports to:" />
                        </div>
                        <div class="fieldValue2Cols">
                            <p:commandLink value="#{employeeController.reportsToList.size() eq 0 ? '' : employeeController.reportsToList[0].employeePK.idNumber}-
                                           #{employeeController.reportsToList[0].firstName} #{employeeController.reportsToList[0].surname}"
                                           actionListener="#{employeeController.linkToAnotherEmployee()}" update="mainBody"/>
                        </div>
                        <div class="fieldName2Cols">
                            <h:outputText value="Home Address:" />
                        </div>
                        <div class="fieldValue2Cols">
                            <h:outputText value="#{employeeSelected.homeAddress}" />
                        </div>
                        <div class="fieldName2Cols">
                            <h:outputText value="Suburb" />
                        </div>
                        <div class="fieldValue2Cols">
                            <h:outputText value="#{employeeSelected.suburb}" />
                        </div>
                        <div class="fieldName2Cols">
                            <h:outputText value="Post Code / State" />
                        </div>
                        <div class="fieldValue2Cols">
                            <h:outputText value="#{employeeSelected.postcode} / #{employeeSelected.stateCode.stateCode}" />
                        </div>
                        <div class="fieldName2Cols">
                            <h:outputText value="Email" />
                        </div>
                        <div class="fieldValue2Cols">
                            <h:outputText value="#{employeeSelected.businessEmail} " />
                        </div>
                        <div class="fieldName2Cols">
                            <h:outputText value="Personal Email" />
                        </div>
                        <div class="fieldValue2Cols">
                            <h:outputText value="#{employeeSelected.personalEmail} " />
                        </div>
                        <div class="fieldName2Cols">
                            <h:outputText value="Police Check" />
                        </div>
                        <div class="fieldValue2Cols">
<!--                            <h:outputText value="#{employeeSelected.policeCheckCollection[0].expiryDate}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>-->
                            <h:outputText value=" Ref.:#{employeeSelected.policeCheckCollection[0].precedaComment} "/>
                        </div>
                        <div class="fieldName2Cols">
                            <h:outputText value="Visa Details" />
                        </div>
                        <div class="fieldValue2Cols">
<!--                            <h:outputText value="#{employeeSelected.visaCollection[0].visaExpiryDate}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>-->
                            <h:outputText value=" Type:#{employeeSelected.visaCollection[0].precedaComment1} "/>
                        </div>
                    </div>
                </div>
            </p:panel>

            <p:panel id="position" header="Position Information">
                <div class="panelPositionData">
                    <div class="fieldName2Cols">
                        <h:outputText value="Position ID:"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{employeeSelected.positionId.positionId}"/>
                    </div>
                    <div class="fieldName2Cols">
                        <h:outputText value="Position Title:"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{employeeSelected.positionId.positionTitle}"/>
                    </div>
                    <div class="fieldName2Cols">
                        <h:outputText value="Classification:"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{employeeSelected.classificationId.classificationDescription}"/>
                    </div>
                    <div class="fieldName2Cols">
                        <h:outputText value="Reports To:"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{employeeController.reportsToList.size() eq 0 ? 'N/A' : employeeSelected.reportsToPositionId.positionTitle}"/>
                    </div>
                    <div class="fieldNameHigh2Cols">
                        <h:outputText value="Name:"/>
                    </div>
                    <div class="fieldValueHigh2Cols">
                        <h:outputText value="#{employeeController.reportsToList.size() eq 0 ? 'N/A' : employeeController.reportsToList[0].firstName} 
                                      #{employeeController.reportsToList[0].surname}"/>
                    </div>
                    <div class="fieldName2Cols">
                        <h:outputText value="Department:"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{employeeSelected.departmentId.departmentId} - 
                                      #{employeeSelected.departmentId.departmentDescription}"/>
                    </div>
                    <div class="fieldName2Cols">
                        <h:outputText value="Award"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{employeeSelected.awardId.awardCode} - 
                                      #{employeeSelected.awardId.awardDescription}"/>
                    </div>
                </div>
            </p:panel>

            <p:panel id="structure" header="Uniforms information">
                <div class="panelStructureData">
                    <c:set var="uniformSorted" value="#{employeeController.uniformSortedCollection[0]}"/>
                    <div class="fieldName2Cols">
                        <h:outputText value="Allowance"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{employeeSelected.uniformCollection.size() gt 0 ? uniformSorted.allowanceId.allowanceCode : 'N/A'}"/>
                    </div>
                    <div class="fieldName2Cols">
                        <h:outputText value="Location"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{employeeSelected.uniformCollection.size() gt 0 ? 
                                               (uniformSorted.accountNumber ne null ?
                                               uniformSorted.accountNumber.uniformDeaneLocation.facility : 'N/A') : 'N/A'}"/>
                    </div>
                    <div class="fieldName2Cols">
                        <h:outputText value="Sent on"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{employeeSelected.uniformCollection.size() gt 0 ? uniformSorted.uniformPK.dateSent : 'N/A'}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </div>
                </div>
            </p:panel>

            <p:panel id="payroll" header="Payroll Details">
                <div class="panelPayrollData">
                    <c:set var="payroll" value="#{employeeController.payrollList}"/>
                    <div class="fieldNameHigh2Cols">
                        <h:outputText value="Position:"/>
                    </div>
                    <div class="fieldValueHigh2Cols">
                        <h:outputText value="#{employeeSelected.positionId.positionTitle}"/>
                    </div>
                    <div class="fieldName2Cols">
                        <h:outputText value="Employment Type"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{payroll[0].employmentType.employmentTypeDescription}"/>
                    </div>
                    <div class="fieldName2Cols">
                        <h:outputText value="Rate"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{payroll[0].baseRate}">
                            <f:convertNumber currencySymbol="$" type="currency"/>
                        </h:outputText>
                    </div>                    
                    <div class="fieldName2Cols">
                        <h:outputText value="Base Hours"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{payroll[0].baseHoursAmount}"/>
                    </div>
                    <div class="fieldName2Cols">
                        <h:outputText value="Classification"/>
                    </div>
                    <div class="fieldValue2Cols">
                        <h:outputText value="#{payroll[0].baseRateCode}"/>
                    </div>
                </div>
            </p:panel>

            <p:panel id="earning" header="Earnings">
                <div class="panelEarningData">
                    <c:choose>
                        <c:when test="#{not empty employeeController.earningDistinctCollection}">
                            <p:dataTable var="employeeEarning" value="#{employeeController.earningDistinctCollection}" 
                                         scrollable="true" scrollHeight="190">
                                <p:column headerText="Period Date">
                                    <h:outputText value="#{employeeEarning[0]}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Taxable Gross" style="text-align: right">
                                    <h:outputText value="#{employeeEarning[1]}">
                                        <f:convertNumber currencySymbol="$" type="currency"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Tax Amount" style="text-align: right">
                                    <h:outputText value="#{employeeEarning[2]}">
                                        <f:convertNumber currencySymbol="$" type="currency"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Net Pay" style="text-align: right">
                                    <h:outputText value="#{employeeEarning[3]}">
                                        <f:convertNumber currencySymbol="$" type="currency"/>
                                    </h:outputText>
                                </p:column>                              

                                <f:facet name="footer">
                                    <h:outputText value="#{employeeEarnings.size()} items"/>
                                </f:facet>
                            </p:dataTable>
                        </c:when>
                        <c:otherwise>
                            <h:outputText value="No records found."/>
                        </c:otherwise>
                    </c:choose>
                </div>
            </p:panel>

            <p:panel id="earningSummary" header="Earning Summary">
                <div class="panelEarningSummaryData">
                    <c:choose>
                        <c:when test="#{not empty employeeController.earningSummaryList}">

                            <c:set var="employeeEarningsSummary" value="#{employeeController.earningSummaryList[0]}"/>

                            <div class="rowHeader">
                                <h:outputText value="Last Pay Period: "/>
                                <h:outputText value="#{employeeEarningsSummary.earningSummaryPK.paidUpToDate}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </div>
                            <div class="fieldName2Cols">
                                <h:outputText value="Total Earning"/>
                            </div>
                            <div class="fieldValueRight2Cols">
                                <h:outputText value="#{employeeEarningsSummary.ptdTotalEarnings}">
                                    <f:convertNumber currencySymbol="$" type="currency"/>
                                </h:outputText>
                            </div>
                            <div class="fieldName2Cols">
                                <h:outputText value="Taxable Gross"/>
                            </div>
                            <div class="fieldValueRight2Cols">
                                <h:outputText value="#{employeeEarningsSummary.ptdTaxableGross}">
                                    <f:convertNumber currencySymbol="$" type="currency"/>
                                </h:outputText>
                            </div>
                            <div class="fieldName2Cols">
                                <h:outputText value="Tax"/>
                            </div>
                            <div class="fieldValueRight2Cols">
                                <h:outputText value="#{employeeEarningsSummary.ptdTax}">
                                    <f:convertNumber currencySymbol="$" type="currency"/>
                                </h:outputText>
                            </div>
                            <div class="fieldName2Cols">
                                <h:outputText value="Net Pay"/>
                            </div>
                            <div class="fieldValueRight2Cols">
                                <h:outputText value="#{employeeEarningsSummary.ptdNet}">
                                    <f:convertNumber currencySymbol="$" type="currency"/>
                                </h:outputText>
                            </div>

                            <div class="rowHeader">
                                <h:outputText value="Year"/>
                            </div>
                            <div class="fieldName2Cols">
                                <h:outputText value="Total Earning"/>
                            </div>
                            <div class="fieldValueRight2Cols">
                                <h:outputText value="#{employeeEarningsSummary.ytdTotalEarnings}">
                                    <f:convertNumber currencySymbol="$" type="currency"/>
                                </h:outputText>
                            </div>
                            <div class="fieldName2Cols">
                                <h:outputText value="Taxable Gross"/>
                            </div>
                            <div class="fieldValueRight2Cols">
                                <h:outputText value="#{employeeEarningsSummary.taxableGross}">
                                    <f:convertNumber currencySymbol="$" type="currency"/>
                                </h:outputText>
                            </div>
                            <div class="fieldName2Cols">
                                <h:outputText value="Tax"/>
                            </div>
                            <div class="fieldValueRight2Cols">
                                <h:outputText value="#{employeeEarningsSummary.ytdTax}">
                                    <f:convertNumber currencySymbol="$" type="currency"/>
                                </h:outputText>
                            </div>
                            <div class="fieldName2Cols">
                                <h:outputText value="Net Pay"/>
                            </div>
                            <div class="fieldValueRight2Cols">
                                <h:outputText value="#{employeeEarningsSummary.ytdNetPay}">
                                    <f:convertNumber currencySymbol="$" type="currency"/>
                                </h:outputText>
                            </div>
                            <div class="rowHeader">
                                <h:outputText value="Hours Worked"/>
                            </div>
                            <div class="fieldName2Cols">
                                <h:outputText value="Last Period"/>
                            </div>
                            <div class="fieldValueRight2Cols">
                                <h:outputText value="#{employeeEarningsSummary.hoursWorkedThisPay}"/>
                            </div>
                            <div class="fieldName2Cols">
                                <h:outputText value="Since Hired"/>
                            </div>
                            <div class="fieldValueRight2Cols">
                                <h:outputText value="#{employeeEarningsSummary.sinceHired}"/>
                            </div>
                            <div class="fieldName2Cols">
                                <h:outputText value="Last Position"/>
                            </div>
                            <div class="fieldValueRight2Cols">
                                <h:outputText value="#{employeeEarningsSummary.serviceHourslastsalarycode}"/>
                            </div>

                        </c:when>
                        <c:otherwise>
                            <h:outputText value="No records found."/>
                        </c:otherwise>
                    </c:choose>
                </div>
            </p:panel>

            <p:panel id="actions" header="Actions">
                <div class="panelActions">
                    <p:commandButton value="COEC" id="coecButton" icon="ui-icon-comment" 
                                     oncomplete="PF('coecDialog').show()"
                                     update="tabViewMain:mainBody:formCOECDialog"
                                     disabled="#{employeeSelected.employeePK.status ne 'A'}"
                                     actionListener="#{employeeController.openCoec()}" >
                    </p:commandButton>
                </div>
            </p:panel>

            <p:panel id="leave" header="Leaves">
                <div class="panelLeaveData">
                    <c:choose>
                        <c:when test="#{not empty employeeController.leaveList}">
                            <p:dataTable var="leave" value="#{employeeController.leaveList}" 
                                         scrollable="true" scrollHeight="180">
                                <p:column headerText="Classif." width="20%" sortable="true">
                                    <h:outputText value="#{leave.classificationLeave.classificationDescription}"/>
                                </p:column>
                                <p:column headerText="Acc.Method" width="40%">
                                    <h:outputText value="#{leave.accrualMethod.accrualMethodDescription}"/>
                                </p:column>
                                <p:column headerText="Date" width="20%">
                                    <h:outputText value="#{leave.earningLeavePK.dateAccruedTo}">
                                        <f:convertDateTime pattern="dd/MM/yy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Balance" width="20%" style="text-align: right">
                                    <h:outputText value="#{leave.totalEntitlement}">
                                        <f:convertNumber type="number" maxFractionDigits="2"/>
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                        </c:when>
                        <c:otherwise>
                            <h:outputText value="No records found."/>
                        </c:otherwise>
                    </c:choose>
                </div>
            </p:panel>

            <p:panel id="policeCheck" header="Police Check History - HR Comments">
                <div class="panelPoliceCheckData">

                    <p:dataTable var="policeCheckHistory" value="#{employeeController.policeCheckList}" 
                                 scrollable="true" scrollHeight="45">
                        <p:column headerText="Expiry Date" width="35%" sortBy="#{policeCheckHistory.expiryDate}">
                            <h:outputText value="#{policeCheckHistory.expiryDate}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Preceda Comment" width="65%">
                            <h:outputText value="#{policeCheckHistory.precedaComment}"/>
                        </p:column>
                    </p:dataTable>
                    <br/>
                    <p:dataTable var="policeCheckComments" value="#{employeeSelected.policeCheckCommentCollection}" 
                                 scrollable="true" scrollHeight="60">
                        <p:column headerText="Date" width="20%" sortBy="#{policeCheckComments.policeCheckCommentPK.commentDate}">
                            <h:outputText value="#{policeCheckComments.policeCheckCommentPK.commentDate}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Comment" width="55%">
                            <h:outputText value="#{policeCheckComments.comment}"/>
                        </p:column>
                        <!--                        <p:column headerText="User">
                                                    <h:outputText value="#{policeCheckComments.user}"/>
                                                </p:column>-->
                        <p:column headerText="Infra ticket" width="25%">
                            <h:outputText value="#{policeCheckComments.infraTicket}"/>
                        </p:column>
                    </p:dataTable>                 
                </div>
            </p:panel>

            <p:panel id="visa" header="Visa Details - HR Comments">
                <div class="panelVisaData">
                    <p:dataTable var="visa" value="#{employeeController.visaList}" 
                                 scrollable="true" scrollHeight="60">
                        <p:column headerText="Expiry Date" width="35%" sortBy="#{visa.visaExpiryDate}">
                            <h:outputText value="#{visa.visaExpiryDate}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Preceda Comment" width="65%">
                            <h:outputText value="#{visa.precedaComment1}"/>
                        </p:column>
                    </p:dataTable>
                    <br/>
                    <p:dataTable var="visaComments" value="#{employeeSelected.visaCommentCollection}" 
                                 scrollable="true" scrollHeight="60">
                        <p:column headerText="Date" width="20%" sortBy="#{visaComments.visaCommentPK.commentDate}">
                            <h:outputText value="#{visaComments.visaCommentPK.commentDate}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Comment" width="55%">
                            <h:outputText value="#{visaComments.comment}"/>
                        </p:column>
                        <!--                        <p:column headerText="User">
                                                    <h:outputText value="#{visaComments.user}"/>
                                                </p:column>-->
                        <p:column headerText="Infra ticket" width="25%">
                            <h:outputText value="#{visaComments.infraTicket}"/>
                        </p:column>
                    </p:dataTable>           
                </div>
            </p:panel>

        </p:dashboard>
        <ui:include src="/coecForm.xhtml"/>      
    </h:form>

</ui:composition>